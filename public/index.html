<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSV Quantum Vault v3 - Production Ready</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<div class="container">
    <!-- Header -->
    <header class="header">
        <div class="logo">âš›ï¸</div>
        <h1>BSV Quantum Vault</h1>
        <p class="tagline">Production v3.0 â€¢ Quantum-Resistant â€¢ BSV Native</p>
    </header>

    <!-- Critical Alert Banner -->
    <div class="alert alert-warning">
        <div class="alert-icon">âš ï¸</div>
        <div class="alert-content">
            <strong>BSV Genesis Compliance</strong>
            <p>This vault uses <strong>bare scripts</strong> (not P2SH). BSV deprecated P2SH addresses in February 2020. 
            Addresses starting with "3" no longer work on BSV mainnet.</p>
        </div>
    </div>

    <!-- Security Info Banner -->
    <div class="alert alert-info">
        <div class="alert-icon">ğŸ›¡ï¸</div>
        <div class="alert-content">
            <strong>Winternitz One-Time Signatures</strong>
            <p>Your funds are protected by 1024 bytes of quantum-resistant entropy. 
            No ECDSA means no vulnerability to quantum computers.</p>
        </div>
    </div>

    <!-- Create Vault Section -->
    <section class="card" id="createSection">
        <h2>
            <span class="section-icon">â—†</span>
            Create Quantum Vault
        </h2>
        <p class="section-desc">
            Generate a new quantum-resistant vault. Your funds will be locked by a Winternitz 
            signature scheme with 32 independent 32-byte scalars.
        </p>
        
        <!-- Security Level Selection -->
        <div class="vault-options">
            <div class="option-group">
                <label class="option-label">ğŸ›¡ï¸ Security Level</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="securityLevel" value="standard" checked>
                        <span class="radio-custom"></span>
                        <span class="radio-content">
                            <strong>Standard</strong>
                            <small>~35 byte script, lowest fees, basic quantum protection</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="securityLevel" value="enhanced">
                        <span class="radio-custom"></span>
                        <span class="radio-content">
                            <strong>Enhanced</strong>
                            <small>With optional time-lock, medium security</small>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="securityLevel" value="maximum">
                        <span class="radio-custom"></span>
                        <span class="radio-content">
                            <strong>Maximum</strong>
                            <small>~3KB script, full Winternitz verification, front-run immune</small>
                        </span>
                    </label>
                </div>
            </div>
            
            <!-- Time-Lock Options -->
            <div class="option-group" id="timeLockOptions">
                <label class="option-label">
                    <input type="checkbox" id="enableTimeLock" onchange="toggleTimeLock()">
                    ğŸ”’ Enable Time-Lock
                </label>
                <div id="timeLockConfig" class="sub-options hidden">
                    <div class="time-lock-type">
                        <label class="radio-option small">
                            <input type="radio" name="lockType" value="date" checked onchange="toggleLockTypeInput()">
                            <span class="radio-custom"></span>
                            <span>Lock until Date</span>
                        </label>
                        <label class="radio-option small">
                            <input type="radio" name="lockType" value="blocks" onchange="toggleLockTypeInput()">
                            <span class="radio-custom"></span>
                            <span>Lock until Block Height</span>
                        </label>
                    </div>
                    <div id="dateLockInput" class="lock-input">
                        <label>Unlock Date & Time (UTC)</label>
                        <input type="datetime-local" id="unlockDate" min="">
                    </div>
                    <div id="blockLockInput" class="lock-input hidden">
                        <label>Unlock at Block Height</label>
                        <input type="number" id="unlockBlock" placeholder="e.g., 900000" min="1">
                        <small>Current block: ~<span id="currentBlock">873000</span></small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Security Level Info Box -->
        <div id="securityInfo" class="info-box">
            <strong>Standard Security:</strong> Simple preimage check. Quantum-resistant for storage. 
            Theoretically vulnerable to mempool front-running during spend (low practical risk). 
            Lowest fees (~35 sats).
        </div>
        
        <button id="createBtn" class="btn btn-primary btn-large" onclick="createVault()">
            <span class="btn-icon">âš¡</span>
            <span>Generate Vault</span>
        </button>
        
        <!-- Result -->
        <div id="createResult" class="result hidden">
            <!-- Vault ID -->
            <div class="field">
                <label>Vault ID</label>
                <div class="value-box">
                    <span id="vaultId" class="mono">...</span>
                    <button class="copy-btn" onclick="copyToClipboard('vaultId')">ğŸ“‹</button>
                </div>
            </div>
            
            <!-- Script Hash -->
            <div class="field">
                <label>Script Hash (for balance lookup)</label>
                <div class="value-box">
                    <span id="scriptHash" class="mono">...</span>
                    <button class="copy-btn" onclick="copyToClipboard('scriptHash')">ğŸ“‹</button>
                </div>
            </div>
            
            <!-- Security Badge -->
            <div class="security-badge">
                <div class="badge-item">
                    <span class="badge-label">Signature</span>
                    <span class="badge-value" id="sigType">Winternitz OTS</span>
                </div>
                <div class="badge-item">
                    <span class="badge-label">Key Entropy</span>
                    <span class="badge-value" id="keyEntropy">1024 bytes</span>
                </div>
                <div class="badge-item safe">
                    <span class="badge-label">Quantum Safe</span>
                    <span class="badge-value">âœ“ Yes</span>
                </div>
                <div class="badge-item safe">
                    <span class="badge-label">BSV Native</span>
                    <span class="badge-value">âœ“ Bare Script</span>
                </div>
            </div>
            
            <!-- Funding Instructions -->
            <div class="field funding-field">
                <label class="label-important">ğŸ“¥ How to Fund This Vault</label>
                <div class="funding-box">
                    <p><strong>Since BSV doesn't support P2SH addresses</strong>, you must create a transaction 
                    with the locking script directly as the output:</p>
                    <ol>
                        <li>Copy the <strong>Locking Script</strong> below</li>
                        <li>Create a transaction output with this script as <code>scriptPubKey</code></li>
                        <li>Send any amount of BSV to this output</li>
                    </ol>
                    <p class="note">
                        <strong>Note:</strong> Standard wallets may not support bare script outputs. 
                        You may need to use a developer tool or script to create the funding transaction.
                    </p>
                </div>
            </div>
            
            <!-- Locking Script -->
            <div class="field">
                <label onclick="toggleDetails('scriptDetails')" class="clickable">
                    ğŸ” Locking Script (Output Script) 
                    <span class="toggle-icon" id="scriptDetailsIcon">â–¼</span>
                </label>
                <div id="scriptDetails" class="collapsible">
                    <div class="detail-row">
                        <span class="detail-label">ASM:</span>
                        <code id="lockingScriptASM" class="code-block">...</code>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Hex:</span>
                        <code id="lockingScript" class="code-block mono">...</code>
                        <button class="copy-btn small" onclick="copyToClipboard('lockingScript')">ğŸ“‹ Copy</button>
                    </div>
                </div>
            </div>
            
            <!-- MASTER SECRET - CRITICAL -->
            <div class="field secret-field">
                <label class="label-critical">ğŸ”‘ MASTER SECRET - SAVE THIS!</label>
                <div class="secret-box">
                    <textarea id="vaultSecret" readonly rows="4">...</textarea>
                    <button class="copy-btn important" onclick="copyToClipboard('vaultSecret')">
                        ğŸ”’ Copy Master Secret
                    </button>
                </div>
                <div class="warning-box">
                    <strong>âš ï¸ CRITICAL:</strong> This is the ONLY way to access your funds. 
                    Contains your Winternitz private key (32 scalars Ã— 32 bytes = 1024 bytes). 
                    Store it securely offline. If lost, your funds are PERMANENTLY INACCESSIBLE.
                </div>
            </div>
            
            <!-- Continue to Funding Button -->
            <div class="field" style="text-align: center; margin-top: var(--spacing-xl);">
                <button class="btn btn-primary btn-large" onclick="showFundingSection()">
                    <span class="btn-icon">ğŸ’°</span>
                    <span>Continue to Fund Vault</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Fund Vault Section - NEW -->
    <section class="card" id="fundSection" style="display: none;">
        <h2>
            <span class="section-icon green">ğŸ’°</span>
            Fund Your Quantum Vault
        </h2>
        <p class="section-desc">
            Send BSV to your quantum vault using the QR code below. We generate a temporary 
            receiving address that automatically deposits funds into your quantum-resistant vault.
        </p>
        
        <!-- Vault Info Display -->
        <div class="vault-info-banner" id="fundingVaultInfo">
            <div class="vault-info-item">
                <span class="vault-info-label">Target Vault</span>
                <span class="vault-info-value" id="fundingVaultId">Not set</span>
            </div>
        </div>
        
        <!-- Step 1: Load Vault -->
        <div class="funding-step" id="fundStep1">
            <div class="step-header">
                <span class="step-number">1</span>
                <span class="step-title">Load Your Vault</span>
            </div>
            <div class="field">
                <label>Vault Master Secret</label>
                <textarea id="fundingSecretInput" placeholder="Paste your vault master secret here..." rows="3"></textarea>
            </div>
            <button class="btn btn-primary" onclick="loadVaultForFunding()">
                <span class="btn-icon">ğŸ”“</span>
                <span>Load Vault</span>
            </button>
        </div>
        
        <!-- Step 2: Generate Funding Address -->
        <div class="funding-step hidden" id="fundStep2">
            <div class="step-header">
                <span class="step-number">2</span>
                <span class="step-title">Send BSV to This Address</span>
            </div>
            
            <div class="qr-container">
                <div class="qr-box" id="fundingQR"></div>
                <div class="qr-label">Scan with any BSV wallet</div>
            </div>
            
            <div class="funding-address-box">
                <label>Funding Address</label>
                <div class="address-display">
                    <span id="fundingAddressDisplay" class="mono">...</span>
                    <button class="copy-btn" onclick="copyToClipboard('fundingAddressDisplay')">ğŸ“‹</button>
                </div>
                <div class="address-note">
                    âœ“ Standard BSV address - works with any wallet<br>
                    âœ“ Send any amount of BSV to this address
                </div>
            </div>
            
            <!-- Keys Section - Collapsible -->
            <div class="keys-section">
                <label onclick="toggleDetails('fundingKeys')" class="clickable">
                    ğŸ” Address Keys (Click to reveal)
                    <span class="toggle-icon" id="fundingKeysIcon">â–¼</span>
                </label>
                <div id="fundingKeys" class="collapsible keys-content">
                    <div class="key-warning">
                        âš ï¸ These keys give full control of this address. Save them if you want to import elsewhere.
                    </div>
                    
                    <div class="key-field">
                        <label>Private Key (WIF) - Import into any wallet</label>
                        <div class="key-display">
                            <input type="password" id="fundingWIF" readonly class="mono" value="...">
                            <button class="copy-btn" onclick="copyToClipboard('fundingWIF')">ğŸ“‹</button>
                            <button class="copy-btn" onclick="toggleKeyVisibility('fundingWIF')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    
                    <div class="key-field">
                        <label>Private Key (Hex)</label>
                        <div class="key-display">
                            <input type="password" id="fundingPrivKeyHex" readonly class="mono" value="...">
                            <button class="copy-btn" onclick="copyToClipboard('fundingPrivKeyHex')">ğŸ“‹</button>
                            <button class="copy-btn" onclick="toggleKeyVisibility('fundingPrivKeyHex')">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    
                    <div class="key-field">
                        <label>Public Key (Hex)</label>
                        <div class="key-display">
                            <input type="text" id="fundingPubKeyHex" readonly class="mono" value="...">
                            <button class="copy-btn" onclick="copyToClipboard('fundingPubKeyHex')">ğŸ“‹</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="funding-balance-box" id="fundingBalanceBox">
                <div class="balance-header">
                    <span>ğŸ’³ Funding Address Balance</span>
                    <button class="btn btn-small" onclick="refreshFundingBalance()">ğŸ”„ Refresh</button>
                </div>
                <div class="balance-content" id="fundingBalanceContent">
                    <div class="balance-zero">Waiting for deposit...</div>
                </div>
            </div>
            
            <!-- Send Elsewhere Option -->
            <div class="send-elsewhere-section hidden" id="sendElsewhereSection">
                <div class="section-divider">
                    <span>OR</span>
                </div>
                <div class="send-elsewhere-box">
                    <h4>ğŸ“¤ Changed Your Mind?</h4>
                    <p>Send funds to a different address instead of the quantum vault.</p>
                    
                    <div class="field">
                        <label>Destination Address</label>
                        <input type="text" id="sendElsewhereAddress" placeholder="BSV address starting with 1...">
                    </div>
                    
                    <button class="btn btn-secondary" onclick="sendElsewhere()">
                        <span class="btn-icon">â†—ï¸</span>
                        <span>Send to Different Address</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Deposit to Vault -->
        <div class="funding-step hidden" id="fundStep3">
            <div class="step-header">
                <span class="step-number">3</span>
                <span class="step-title">Deposit to Quantum Vault</span>
            </div>
            
            <div class="deposit-ready-box">
                <div class="deposit-icon">âœ…</div>
                <div class="deposit-message">
                    Funds detected! Click below to deposit them into your quantum-resistant vault.
                </div>
                <div class="deposit-amount" id="depositAmountDisplay">0.00000000 BSV</div>
            </div>
            
            <button class="btn btn-primary btn-large" id="depositBtn" onclick="depositToVault()">
                <span class="btn-icon">ğŸš€</span>
                <span>Deposit to Quantum Vault</span>
            </button>
            
            <div class="deposit-note">
                This will move funds from the temporary address into your quantum-resistant vault,
                protected by Winternitz one-time signatures.
            </div>
        </div>
        
        <!-- Deposit Result -->
        <div id="depositResult" class="status-box"></div>
    </section>

    <!-- Access Vault Section -->
    <section class="card" id="accessSection">
        <h2>
            <span class="section-icon blue">â—ˆ</span>
            Access Vault
        </h2>
        
        <div class="field">
            <label>Master Secret</label>
            <textarea id="inputSecret" placeholder="Paste your vault master secret here..." rows="3"></textarea>
        </div>
        
        <div class="field">
            <label>Destination Address</label>
            <input type="text" id="inputAddress" placeholder="BSV P2PKH address (starting with 1)">
            <span class="help-text">Only P2PKH addresses (starting with "1") are supported as destinations.</span>
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" onclick="checkBalance()">
                <span class="btn-icon">ğŸ“Š</span>
                Check Balance
            </button>
            <button class="btn btn-primary" onclick="sweepVault()">
                <span class="btn-icon">ğŸ’¸</span>
                Sweep Funds
            </button>
            <button class="btn btn-secondary" onclick="quickFund()">
                <span class="btn-icon">ğŸ’°</span>
                Fund Vault
            </button>
        </div>
        
        <div id="accessStatus" class="status-box"></div>
    </section>

    <!-- Security Comparison -->
    <section class="card info-card">
        <h2>
            <span class="section-icon">âš–ï¸</span>
            Security Comparison
        </h2>
        
        <div class="comparison-table">
            <div class="comp-header">
                <div class="comp-cell">Feature</div>
                <div class="comp-cell">Simple Hash-Lock</div>
                <div class="comp-cell">Quantum Vault v3</div>
            </div>
            <div class="comp-row">
                <div class="comp-cell">Quantum Resistant</div>
                <div class="comp-cell good">âœ“</div>
                <div class="comp-cell good">âœ“</div>
            </div>
            <div class="comp-row">
                <div class="comp-cell">BSV Compatible</div>
                <div class="comp-cell bad">âœ— (uses P2SH)</div>
                <div class="comp-cell good">âœ“ (bare script)</div>
            </div>
            <div class="comp-row">
                <div class="comp-cell">Key Entropy</div>
                <div class="comp-cell">32 bytes</div>
                <div class="comp-cell good">1024 bytes</div>
            </div>
            <div class="comp-row">
                <div class="comp-cell">Signature Type</div>
                <div class="comp-cell">Preimage</div>
                <div class="comp-cell good">Winternitz OTS</div>
            </div>
            <div class="comp-row">
                <div class="comp-cell">Post-Genesis BSV</div>
                <div class="comp-cell bad">âœ—</div>
                <div class="comp-cell good">âœ“</div>
            </div>
        </div>
    </section>

    <!-- Technical Details -->
    <section class="card info-card">
        <h2>
            <span class="section-icon purple">ğŸ”¬</span>
            Technical Details
        </h2>
        
        <div class="tech-grid">
            <div class="tech-item">
                <span class="tech-label">Output Type</span>
                <span class="tech-value">Bare Script (NOT P2SH)</span>
            </div>
            <div class="tech-item">
                <span class="tech-label">Signature Scheme</span>
                <span class="tech-value">Winternitz OTS</span>
            </div>
            <div class="tech-item">
                <span class="tech-label">Private Key Size</span>
                <span class="tech-value">1024 bytes (32 Ã— 32)</span>
            </div>
            <div class="tech-item">
                <span class="tech-label">Hash Algorithm</span>
                <span class="tech-value mono">HASH256 (double SHA256)</span>
            </div>
            <div class="tech-item">
                <span class="tech-label">Hash Iterations</span>
                <span class="tech-value">256 per chunk</span>
            </div>
            <div class="tech-item">
                <span class="tech-label">Network</span>
                <span class="tech-value">BSV Mainnet</span>
            </div>
        </div>
        
        <div class="info-section">
            <h3>How Winternitz Signatures Work</h3>
            <ol>
                <li><strong>Key Generation:</strong> 32 random scalars are created. Each is hashed 256 times to create a public commitment.</li>
                <li><strong>Commitment:</strong> All 32 public commitments are concatenated and hashed to create the public key hash.</li>
                <li><strong>Locking:</strong> The script requires the preimage that hashes to the public key hash.</li>
                <li><strong>Unlocking:</strong> The spender provides the concatenated public commitments (1024 bytes).</li>
            </ol>
        </div>
        
        <div class="info-section warning">
            <h3>âš ï¸ Why No P2SH?</h3>
            <p>BSV's Genesis upgrade in February 2020 removed support for P2SH (Pay-to-Script-Hash) outputs. 
            This means addresses starting with "3" cannot receive or hold funds on BSV mainnet.</p>
            <p>Our vault uses <strong>bare scripts</strong> where the locking script is placed directly 
            in the transaction output, without the P2SH wrapper.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>BSV Quantum Vault v3.0 â€¢ Built for the post-quantum future</p>
        <div class="footer-links">
            <a href="https://whatsonchain.com" target="_blank">WhatsOnChain</a>
            <span>â€¢</span>
            <a href="javascript:void(0)" onclick="showInfo()">Security Info</a>
            <span>â€¢</span>
            <a href="javascript:void(0)" onclick="showHelp()">Help</a>
        </div>
    </footer>
</div>

<!-- Notification Container -->
<div id="notificationContainer"></div>

<script src="app.js"></script>

</body>
</html>
